//-----------------------------------------------------------------------------
// TargetBL_Commands.c

//-----------------------------------------------------------------------------
// Includes
//-----------------------------------------------------------------------------
#include "main.h"
#include "Target_Config.h"
#include "Target_Interface.h"

#include "TargetBL_Config.h"
#include "TargetBL_Interface.h"

#include "UART_Interface.h"

//-----------------------------------------------------------------------------
// Global CONSTANTS
//-----------------------------------------------------------------------------


//-----------------------------------------------------------------------------
// Global Variables
//-----------------------------------------------------------------------------

uint8_t Flash_Key0 = 0;
uint8_t Flash_Key1 = 0;

//-----------------------------------------------------------------------------
// Function Prototypes (Local)
//-----------------------------------------------------------------------------


//=============================================================================
// Function Definitions
//=============================================================================


//-----------------------------------------------------------------------------
// TGT_Erase_Page
//-----------------------------------------------------------------------------
//
// Return Value:  None
// Parameters:    None
//
// Erases one page of flash.
//-----------------------------------------------------------------------------
void TGT_Erase_Page(uint16_t Addr)
{
    PSCTL |= 0x03;
    FLASH_Modify(Addr, 0x00);
}

//-----------------------------------------------------------------------------
// TGT_Write_Flash
//-----------------------------------------------------------------------------
//
// Return Value:  None
// Parameters:    None
//
// Writes 512 bytes of flash.
//-----------------------------------------------------------------------------
void TGT_Write_Flash(uint8_t *buf, uint32_t addr)
{
	uint8_t xdata * ptr = buf;
	uint32_t count = TGT_FLASH_PAGE_SIZE;
    // Setup for flash operation
    while (count--)
    {
        PSCTL |= 0x01;
        FLASH_Modify(addr++, *ptr++);
    }
}
//-----------------------------------------------------------------------------
// End Of File
//-----------------------------------------------------------------------------
